<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GastroLogic | Cocina Inteligente</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        chef: { 500: '#FF6B6B', 600: '#EE5253' }, // Rojo Gourmet
                        sage: { 100: '#E8F5E9', 500: '#4CAF50', 600: '#388E3C' }, // Verde Fresco
                        dark: '#2D3436',
                        light: '#F7F9FC'
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #FF6B6B; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Animaciones */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-light text-dark h-screen flex flex-col overflow-hidden selection:bg-chef-500 selection:text-white" x-data="app()">

    <header class="bg-white px-5 py-4 flex justify-between items-center shadow-sm z-20 shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-chef-500 text-white p-2 rounded-xl shadow-md shadow-chef-500/20">
                <i data-lucide="utensils-crossed" class="w-5 h-5"></i>
            </div>
            <div>
                <h1 class="font-black text-lg leading-none tracking-tight">GastroLogic</h1>
                <p class="text-[10px] text-gray-400 font-bold tracking-widest uppercase mt-0.5">Chef Personal AI</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full animate-pulse" :class="loading ? 'bg-amber-400' : 'bg-sage-500'"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto hide-scrollbar relative p-4 pb-24">
        
        <div x-show="view === 'stock'" class="fade-in space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                    <div class="text-gray-400 text-[10px] font-bold uppercase">Total Items</div>
                    <div class="text-3xl font-black text-dark mt-1" x-text="inventory.length">0</div>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                    <div class="text-chef-500 text-[10px] font-bold uppercase">Por Vencer</div>
                    <div class="text-3xl font-black text-chef-500 mt-1" x-text="inventory.filter(i => checkExpiry(i.vencimiento)).length">0</div>
                </div>
            </div>

            <div class="flex gap-2 overflow-x-auto hide-scrollbar py-1">
                <button @click="filter = 'all'" :class="filter === 'all' ? 'bg-dark text-white' : 'bg-white text-gray-400 border border-gray-100'" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors">Todo</button>
                <button @click="filter = 'low'" :class="filter === 'low' ? 'bg-dark text-white' : 'bg-white text-gray-400 border border-gray-100'" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors">Faltantes</button>
                <button @click="filter = 'expiring'" :class="filter === 'expiring' ? 'bg-dark text-white' : 'bg-white text-gray-400 border border-gray-100'" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors">Vencimientos</button>
            </div>

            <div class="space-y-2">
                <template x-if="loading && inventory.length === 0">
                    <div class="text-center py-10"><div class="loader mx-auto"></div></div>
                </template>
                
                <template x-for="item in filteredInventory()" :key="item.item_id">
                    <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center justify-between group active:scale-[0.99] transition-transform">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-lg shadow-inner shrink-0" x-text="getIcon(item.categoria)">üì¶</div>
                            <div class="min-w-0">
                                <h4 class="font-bold text-sm text-dark truncate" x-text="item.nombre">Item</h4>
                                <div class="flex items-center gap-2 mt-0.5">
                                    <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded" x-text="item.categoria">Cat</span>
                                    <span x-show="item.vencimiento" class="text-[9px] font-bold flex items-center gap-1" :class="checkExpiry(item.vencimiento) ? 'text-chef-500' : 'text-sage-600'">
                                        <i data-lucide="clock" class="w-3 h-3"></i> <span x-text="formatDate(item.vencimiento)"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right pl-2 shrink-0">
                            <div class="font-black text-sm" :class="item.cantidad <= 1 ? 'text-chef-500' : 'text-dark'">
                                <span x-text="item.cantidad">0</span> <span class="text-[10px] text-gray-400 font-medium" x-text="item.unidad">u</span>
                            </div>
                            <button @click="deleteItem(item.item_id)" class="text-[10px] font-bold text-red-300 hover:text-red-500">Borrar</button>
                        </div>
                    </div>
                </template>
                
                <div x-show="inventory.length === 0 && !loading" class="text-center py-10 opacity-50">
                    <i data-lucide="package-open" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                    <p class="text-xs font-medium text-gray-400">Tu alacena est√° vac√≠a</p>
                </div>
            </div>
            
            <button @click="modalOpen = true" class="fixed bottom-24 right-5 bg-dark text-white p-4 rounded-full shadow-xl shadow-dark/30 hover:scale-110 active:scale-95 transition-all z-30">
                <i data-lucide="plus" class="w-6 h-6"></i>
            </button>
        </div>

        <div x-show="view === 'recipes'" class="fade-in space-y-4">
            <div class="bg-gradient-to-br from-dark to-gray-800 rounded-2xl p-5 text-white shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="sparkles" class="w-24 h-24"></i></div>
                <h2 class="font-bold text-lg relative z-10 flex items-center gap-2"><i data-lucide="bot" class="w-5 h-5 text-chef-500"></i> Chef Gemini</h2>
                <p class="text-xs text-gray-300 mt-1 relative z-10">¬øQu√© cocinamos hoy? Pega un link de IG o pide sugerencias.</p>
                <div class="mt-4 flex gap-2 relative z-10">
                    <input type="text" placeholder="Ej: Receta con pollo y papas..." class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-chef-500 backdrop-blur-sm">
                    <button class="bg-chef-500 hover:bg-chef-600 text-white p-2 rounded-lg transition-colors"><i data-lucide="send" class="w-5 h-5"></i></button>
                </div>
                <div class="mt-3 flex gap-2 relative z-10">
                    <button class="text-[10px] font-bold bg-white/5 hover:bg-white/20 px-2 py-1 rounded border border-white/10">üé≤ Sorpr√©ndeme</button>
                    <button class="text-[10px] font-bold bg-white/5 hover:bg-white/20 px-2 py-1 rounded border border-white/10">ü•ó Saludable</button>
                    <button class="text-[10px] font-bold bg-white/5 hover:bg-white/20 px-2 py-1 rounded border border-white/10">‚è±Ô∏è R√°pido</button>
                </div>
            </div>

            <h3 class="font-bold text-lg mt-6">Mis Recetas</h3>
            <div class="grid gap-3">
                <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100">
                    <div class="h-32 bg-gray-200 relative">
                        <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=500&q=60" class="w-full h-full object-cover">
                        <div class="absolute bottom-2 right-2 bg-white/90 px-2 py-1 rounded text-[10px] font-bold shadow-sm">25 min</div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-bold text-dark">Bowl Saludable de Pollo</h4>
                        <div class="flex items-center justify-between mt-2">
                            <span class="text-[10px] text-gray-400 font-medium">35g Prote√≠na</span>
                            <button class="text-chef-500 hover:text-chef-600"><i data-lucide="arrow-right-circle" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="view === 'planner'" class="fade-in space-y-4">
            <h2 class="font-bold text-lg">Plan Semanal</h2>
            <div class="space-y-3">
                <template x-for="day in ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo']">
                    <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-sm text-dark" x-text="day"></span>
                            <button class="text-gray-300 hover:text-chef-500"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2 p-2 rounded-lg bg-gray-50 border border-gray-100 border-dashed">
                                <span class="text-[10px] font-bold text-gray-400 uppercase w-12">Almuerzo</span>
                                <span class="text-xs text-gray-400 italic">Sin asignar</span>
                            </div>
                            <div class="flex items-center gap-2 p-2 rounded-lg bg-gray-50 border border-gray-100 border-dashed">
                                <span class="text-[10px] font-bold text-gray-400 uppercase w-12">Cena</span>
                                <span class="text-xs text-gray-400 italic">Sin asignar</span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="view === 'shopping'" class="fade-in space-y-4">
            <div class="flex justify-between items-end">
                <h2 class="font-bold text-lg">Lista de Compras</h2>
                <button class="text-xs font-bold text-chef-500 bg-chef-50 px-3 py-1 rounded-lg">Generar Autom√°tica</button>
            </div>
            
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-4 border-b border-gray-50 flex items-center gap-3">
                    <input type="checkbox" class="w-5 h-5 rounded text-chef-500 focus:ring-chef-500 border-gray-300">
                    <div class="flex-1">
                        <div class="font-bold text-sm text-dark">Aceite de Oliva</div>
                        <div class="text-[10px] text-gray-400">Falta para recetas de la semana</div>
                    </div>
                    <span class="text-xs font-bold text-gray-300">1 u</span>
                </div>
                 <div class="p-4 flex items-center gap-3 opacity-50">
                    <input type="checkbox" checked class="w-5 h-5 rounded text-chef-500 focus:ring-chef-500 border-gray-300">
                    <div class="flex-1">
                        <div class="font-bold text-sm text-dark line-through">Papel de Cocina</div>
                    </div>
                    <span class="text-xs font-bold text-gray-300">2 u</span>
                </div>
            </div>
        </div>

    </main>

    <nav class="bg-white border-t border-gray-100 px-6 py-3 flex justify-between items-center shrink-0 z-40 pb-safe">
        <button @click="view = 'stock'" class="flex flex-col items-center gap-1 transition-colors" :class="view === 'stock' ? 'text-dark' : 'text-gray-300'">
            <i data-lucide="package" class="w-6 h-6" :stroke-width="view === 'stock' ? 2.5 : 2"></i>
            <span class="text-[9px] font-bold uppercase tracking-wide">Stock</span>
        </button>
        <button @click="view = 'recipes'" class="flex flex-col items-center gap-1 transition-colors" :class="view === 'recipes' ? 'text-dark' : 'text-gray-300'">
            <i data-lucide="chef-hat" class="w-6 h-6" :stroke-width="view === 'recipes' ? 2.5 : 2"></i>
            <span class="text-[9px] font-bold uppercase tracking-wide">Chef AI</span>
        </button>
        <button @click="view = 'planner'" class="flex flex-col items-center gap-1 transition-colors" :class="view === 'planner' ? 'text-dark' : 'text-gray-300'">
            <i data-lucide="calendar-days" class="w-6 h-6" :stroke-width="view === 'planner' ? 2.5 : 2"></i>
            <span class="text-[9px] font-bold uppercase tracking-wide">Plan</span>
        </button>
        <button @click="view = 'shopping'" class="flex flex-col items-center gap-1 transition-colors" :class="view === 'shopping' ? 'text-dark' : 'text-gray-300'">
            <i data-lucide="shopping-cart" class="w-6 h-6" :stroke-width="view === 'shopping' ? 2.5 : 2"></i>
            <span class="text-[9px] font-bold uppercase tracking-wide">Compras</span>
        </button>
    </nav>

    <div x-show="modalOpen" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center" style="display: none;">
        <div class="absolute inset-0 bg-dark/60 backdrop-blur-sm transition-opacity" @click="modalOpen = false"></div>
        <div class="bg-white w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl relative z-10 transform transition-transform"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="translate-y-full"
             x-transition:enter-end="translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="translate-y-0"
             x-transition:leave-end="translate-y-full">
            
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-xl text-dark">Guardar Producto</h3>
                <button @click="modalOpen = false" class="bg-gray-100 p-2 rounded-full text-gray-500 hover:bg-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <form @submit.prevent="saveItem" class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1.5 ml-1">Nombre del producto</label>
                    <input x-model="newItem.nombre" type="text" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-bold text-dark focus:outline-none focus:border-dark focus:ring-1 focus:ring-dark transition-all" placeholder="Ej: At√∫n al natural" required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1.5 ml-1">Categor√≠a</label>
                        <select x-model="newItem.categoria" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-bold text-dark focus:outline-none focus:border-dark appearance-none">
                            <option>Almac√©n</option><option>Carnes</option><option>L√°cteos</option><option>Verduler√≠a</option><option>Congelados</option><option>Bebidas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1.5 ml-1">Vencimiento</label>
                        <input x-model="newItem.vencimiento" type="date" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-bold text-gray-500 focus:outline-none focus:border-dark">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1.5 ml-1">Cantidad</label>
                        <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl overflow-hidden">
                            <button type="button" @click="newItem.cantidad > 1 ? newItem.cantidad-- : null" class="px-3 py-3 hover:bg-gray-200 text-dark font-bold">-</button>
                            <input x-model="newItem.cantidad" type="number" class="w-full bg-transparent text-center font-bold text-dark focus:outline-none" required>
                            <button type="button" @click="newItem.cantidad++" class="px-3 py-3 hover:bg-gray-200 text-dark font-bold">+</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1.5 ml-1">Unidad</label>
                        <select x-model="newItem.unidad" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 text-sm font-bold text-dark focus:outline-none text-center appearance-none">
                            <option>u</option><option>kg</option><option>g</option><option>L</option><option>ml</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="w-full bg-dark text-white font-bold py-4 rounded-xl mt-4 shadow-lg shadow-dark/20 hover:bg-black active:scale-[0.98] transition-all flex justify-center items-center gap-2">
                    <span x-show="!saving">Guardar en Alacena</span>
                    <span x-show="saving" class="flex items-center gap-2"><div class="loader w-4 h-4 border-white border-t-transparent"></div> Guardando...</span>
                </button>
            </form>
        </div>
    </div>

    <script>
        function app() {
            return {
                view: 'stock', // stock, recipes, planner, shopping
                filter: 'all',
                inventory: [],
                loading: true,
                saving: false,
                modalOpen: false,
                newItem: { nombre: '', categoria: 'Almac√©n', cantidad: 1, unidad: 'u', vencimiento: '' },
                
                // TU URL DE GOOGLE APPS SCRIPT
                apiUrl: 'https://script.google.com/macros/s/AKfycbx4QJkbWUwiQD1mcmOXygyTGoe9kt9j3laFFtfots2jlDZR2eX3sTrn-0rfmRCvtWSA/exec',

                init() {
                    this.loadData();
                    lucide.createIcons();
                },

                async loadData() {
                    try {
                        const res = await fetch(`${this.apiUrl}?v=data`);
                        const data = await res.json();
                        this.inventory = data.inventory || [];
                        this.loading = false;
                        setTimeout(() => lucide.createIcons(), 100);
                    } catch (e) {
                        console.error("Error cargando:", e);
                        this.loading = false;
                    }
                },

                async saveItem() {
                    this.saving = true;
                    const itemPayload = {
                        item_id: 'ITM-' + Date.now(),
                        ...this.newItem
                    };
                    
                    // Optimistic update
                    this.inventory.unshift(itemPayload);
                    this.modalOpen = false;
                    
                    try {
                        await fetch(this.apiUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ action: 'SAVE_INVENTORY', item: itemPayload })
                        });
                        // Reset form
                        this.newItem = { nombre: '', categoria: 'Almac√©n', cantidad: 1, unidad: 'u', vencimiento: '' };
                    } catch (e) {
                        alert("Error de conexi√≥n, el item se perder√° al recargar.");
                    } finally {
                        this.saving = false;
                        setTimeout(() => lucide.createIcons(), 100);
                    }
                },

                async deleteItem(id) {
                    if(!confirm('¬øEliminar producto?')) return;
                    this.inventory = this.inventory.filter(i => i.item_id !== id);
                    await fetch(this.apiUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ action: 'DELETE_INVENTORY', id: id })
                    });
                },

                filteredInventory() {
                    if (this.filter === 'all') return this.inventory;
                    if (this.filter === 'low') return this.inventory.filter(i => i.cantidad <= 1); // Simple logic
                    if (this.filter === 'expiring') return this.inventory.filter(i => this.checkExpiry(i.vencimiento));
                    return this.inventory;
                },

                checkExpiry(dateStr) {
                    if(!dateStr) return false;
                    const today = new Date();
                    const exp = new Date(dateStr);
                    const diffTime = exp - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    return diffDays <= 7; // Alerta si vence en 7 d√≠as o menos
                },

                getIcon(cat) {
                    const map = { 'Carnes': 'ü•©', 'Verduler√≠a': 'ü•¶', 'L√°cteos': 'üßÄ', 'Bebidas': 'ü•§', 'Congelados': 'üßä', 'Almac√©n': 'ü•´' };
                    return map[cat] || 'üì¶';
                },

                formatDate(dateStr) {
                    if(!dateStr) return '';
                    const d = new Date(dateStr);
                    return d.toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit'});
                }
            }
        }
    </script>
</body>
</html>
